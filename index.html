
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Dominate</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        padding: 50px;
        background: #111;
        color: white;
      }
      h1 {
        font-size: 3em;
        margin-bottom: 0.5em;
      }
      p {
        font-size: 1.2em;
      }
      button {
        margin-top: 20px;
        font-size: 1em;
        padding: 10px 20px;
        cursor: pointer;
        background-color: #28a745;
        border: none;
        border-radius: 5px;
        color: white;
      }
      input {
        font-size: 1em;
        padding: 10px;
        margin-top: 20px;
        width: 80%;
        background-color: #222;
        color: white;
        border: none;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <h1>¬°Bienvenido a Dominate!</h1>
    <p>Pronto conquistar√°s el mundo... üåç</p>
    
    <div id="nombre-section">
      <p>Ingresa tu nombre de usuario:</p>
      <input type="text" id="username" placeholder="Tu nombre..." />
      <button onclick="confirmarNombre()">Confirmar</button>
    </div>
    
    <div id="opciones-section" style="display:none;">
      <p id="welcome-message"></p>
      <button onclick="crearPartida()">Crear partida</button>
      <button onclick="unirsePartida()">Unirse a partida</button>
    </div>

    <div id="partida-section" style="display:none;">
      <h2>Esperando jugadores...</h2>
      <button id="ver-id-btn" onclick="verId()">Ver ID de la partida</button>
      <button onclick="volver()">Volver</button>
      <p id="partida-id"></p>
      <ul id="jugadores"></ul>
    </div>
    
    <div id="unirse-section" style="display:none;">
      <input type="text" id="partida-id-input" placeholder="ID de la partida" />
      <button onclick="unirse()">Unirse</button>
      <button onclick="volver()">Volver</button>
      <p id="unirse-error" style="color: red; display: none;">ID de la partida incorrecto.</p>
    </div>

    <script>
      let nombre = "";
      let partidaId = null;
      let jugadores = [];

      function confirmarNombre() {
        const username = document.getElementById("username").value;
        if (username.trim() === "") {
          alert("Por favor, ingresa un nombre de usuario.");
          return;
        }
        nombre = username;
        document.getElementById("nombre-section").style.display = "none";
        document.getElementById("welcome-message").textContent = "Bienvenido, " + nombre + "!";
        document.getElementById("opciones-section").style.display = "block";
      }

      function crearPartida() {
        fetch("https://dominate-server.onrender.com/partida", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ nombre: nombre })
        })
          .then((res) => res.json())
          .then((data) => {
            partidaId = data.id;
            jugadores = [nombre];
            mostrarSalaEspera();
          })
          .catch((err) => {
            alert("Error al crear partida: " + err.message);
          });
      }

      function unirsePartida() {
        document.getElementById("opciones-section").style.display = "none";
        document.getElementById("unirse-section").style.display = "block";
      }

      function unirse() {
        const partidaInput = document.getElementById("partida-id-input").value;
        if (partidaInput.trim() === "") {
          alert("Por favor, ingresa un ID de partida.");
          return;
        }
        fetch("https://dominate-server.onrender.com/partida/" + partidaInput)
          .then((res) => {
            if (!res.ok) {
              throw new Error("ID de partida incorrecto.");
            }
            return res.json();
          })
          .then((data) => {
            jugadores.push(nombre);
            partidaId = data.id;
            mostrarSalaEspera();
          })
          .catch((err) => {
            document.getElementById("unirse-error").style.display = "block";
          });
      }

      function mostrarSalaEspera() {
        document.getElementById("unirse-section").style.display = "none";
        document.getElementById("partida-section").style.display = "block";
        document.getElementById("partida-id").textContent = "ID de la partida: " + partidaId;
        document.getElementById("jugadores").innerHTML = jugadores.map(jugador => "<li>" + jugador + "</li>").join("");
        actualizarSala();
      }

      function verId() {
        alert("ID de la partida: " + partidaId);
      }

      function volver() {
        document.getElementById("partida-section").style.display = "none";
        document.getElementById("unirse-section").style.display = "none";
        document.getElementById("opciones-section").style.display = "block";
        partidaId = null;
        jugadores = [];
      }

      function actualizarSala() {
        setInterval(() => {
          document.getElementById("jugadores").innerHTML = jugadores.map(jugador => "<li>" + jugador + "</li>").join("");
        }, 1000);
      }
    </script>
  </body>
</html>
